<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Crypto Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: 'Montserrat', 'Inter', system-ui, sans-serif; }
    .fade-in { animation: fadeIn 0.4s; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .modal-bg { background: rgba(0,0,0,0.85); }
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    .star-btn {
      position: absolute;
      top: 18px;
      right: 18px;
      font-size: 1.5rem;
      background: none;
      border: none;
      cursor: pointer;
      z-index: 2;
      transition: color 0.2s;
    }
    .star-btn.gold { color: #FFD700; }
    .star-btn.gray { color: #d1d5db; }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@900;700&display=swap" rel="stylesheet">
</head>
<body class="bg-black text-white min-h-screen flex flex-col items-center px-2 py-6">

 
  <h1 class="text-5xl md:text-6xl font-extrabold text-center mb-20 tracking-tight bg-gradient-to-r from-green-400 to-cyan-400 bg-clip-text text-transparent drop-shadow-lg select-none" style="font-family:'Montserrat',sans-serif;">Crypto Dashboard</h1>

  <!-- Filter Bar -->
  <div class="w-full max-w-2xl mx-auto mb-6 flex flex-col md:flex-row gap-3 items-center justify-between">
    <input id="searchCoin" type="text" placeholder="Search coins..." class="bg-black border border-white/20 rounded-lg px-4 py-3 text-white focus:border-green-400 transition w-full text-lg font-semibold" autocomplete="off">
    <div class="flex gap-2 mt-2 md:mt-0">
      <button id="filterAll" class="bg-white/10 hover:bg-green-700 text-white px-3 py-2 rounded font-bold text-sm transition">All</button>
      <button id="filterUp" class="bg-white/10 hover:bg-green-700 text-white px-3 py-2 rounded font-bold text-sm transition">Top Gainers</button>
      <button id="filterDown" class="bg-white/10 hover:bg-green-700 text-white px-3 py-2 rounded font-bold text-sm transition">Top Losers</button>
      <button id="filterFavs" class="bg-white/10 hover:bg-yellow-500 text-yellow-300 px-3 py-2 rounded font-bold text-sm transition">⭐ Favorites</button>
    </div>
  </div>

  <!-- Market Overview Section -->
  <div class="w-full max-w-7xl mx-auto mb-8">
    <div id="marketStatus" class="text-center text-gray-400 text-lg mb-4"></div>
    <div id="market" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"></div>
  </div>

  <!-- Modal for Coin Chart -->
  <div id="modal" class="fixed inset-0 z-50 hidden items-center justify-center modal-bg">
    <div class="w-full h-full flex items-center justify-center">
      <div class="bg-black rounded-2xl shadow-2xl p-8 max-w-2xl w-full fade-in relative flex flex-col gap-4">
        <button id="closeModal" type="button" class="absolute top-4 right-6 text-white text-3xl font-bold hover:text-green-400 transition z-10">&times;</button>
        <h3 id="modalTitle" class="text-2xl font-bold mb-4" style="font-family:'Montserrat',sans-serif;"></h3>
        <div id="modalChartContainer" style="min-height:260px;display:flex;align-items:center;justify-content:center;">
          <span id="modalChartLoading" class="text-gray-400 text-lg">Loading...</span>
          <canvas id="modalChart" height="260" style="display:none;"></canvas>
        </div>
      </div>
    </div>
  </div>

 
  <footer class="w-full flex flex-col items-center justify-center mt-12 mb-2">
    <a href="https://geigi.net" target="_blank" class="font-extrabold text-lg text-cyan-300 hover:text-green-400 transition" style="font-family:'Montserrat',sans-serif;">geigi.net</a>
    <div class="text-xs text-gray-400 mt-1">
      Powered by <a href="https://coingecko.com" target="_blank" class="underline text-green-400">CoinGecko API</a>
    </div>
  </footer>

  <script>
    // --- Favorites ---
    function getFavorites() {
      try {
        return JSON.parse(localStorage.getItem("crypto_favorites") || "[]");
      } catch { return []; }
    }
    function saveFavorites(arr) {
      localStorage.setItem("crypto_favorites", JSON.stringify(arr));
    }
    function isFavorite(id) {
      return getFavorites().includes(id);
    }
    function toggleFavorite(id) {
      let favs = getFavorites();
      if (favs.includes(id)) {
        favs = favs.filter(f => f !== id);
      } else {
        favs.push(id);
      }
      saveFavorites(favs);
      renderMarket(coinsShown);
    }

    // --- Market Overview ---
    let allCoins = [];
    let coinsShown = [];
    let marketLoaded = false;
    let marketTimeout = null;
    let currentFilter = "all";

    async function loadMarket() {
      marketLoaded = false;
      document.getElementById("marketStatus").textContent = "Loading...";
      let coins = [];
      let failed = false;
      marketTimeout = setTimeout(() => {
        if (!marketLoaded) {
          document.getElementById("marketStatus").textContent = "Failed to load coins. Please try again later.";
          failed = true;
        }
      }, 20000);

     
      for (let i = 1; i <= 5; i++) {
        const url = `https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=20&page=${i}`;
        try {
          const res = await fetch(url);
          const data = await res.json();
          coins = coins.concat(data);
        } catch {}
      }
      if (!failed) {
        allCoins = coins;
        coinsShown = coins;
        marketLoaded = true;
        clearTimeout(marketTimeout);
        document.getElementById("marketStatus").textContent = "";
        renderMarket(coins);
      }
    }

    function renderMarket(coins) {
      let html = "";
      coins.forEach((coin, idx) => {
        const change = coin.price_change_percentage_24h;
        const up = change >= 0;
        html += `
          <div class="bg-white/5 rounded-2xl shadow-lg p-6 flex flex-col gap-2 items-center cursor-pointer hover:scale-[1.04] transition fade-in relative"
            style="animation-delay:${idx*40}ms"
            onclick="showCoinModal('${coin.id}','${coin.name}','${coin.symbol}')">
            <button class="star-btn ${isFavorite(coin.id) ? 'gold' : 'gray'}" title="Favorite" onclick="event.stopPropagation();toggleFavorite('${coin.id}')">
              ${isFavorite(coin.id) ? '★' : '☆'}
            </button>
            <img src="${coin.image}" alt="${coin.name}" class="w-12 h-12 rounded-full shadow mb-2">
            <div class="font-bold text-lg" style="font-family:'Montserrat',sans-serif;">${coin.name}</div>
            <div class="text-gray-400 text-sm">${coin.symbol.toUpperCase()}</div>
            <div class="font-bold text-2xl">$${coin.current_price.toLocaleString()}</div>
            <div class="${up ? 'text-green-400' : 'text-red-400'} font-bold flex items-center gap-1">
              ${up ? '<span>▲</span>' : '<span>▼</span>'}
              ${change ? change.toFixed(2) : '0.00'}%
            </div>
          </div>
        `;
      });
      document.getElementById("market").innerHTML = html;
     
      setTimeout(() => {
        document.querySelectorAll('.fade-in').forEach((el, i) => {
          el.style.opacity = 0;
          el.style.transform = "translateY(40px)";
          setTimeout(() => {
            el.style.transition = "all 0.5s cubic-bezier(.4,2,.3,1)";
            el.style.opacity = 1;
            el.style.transform = "translateY(0)";
          }, 100 + i * 40);
        });
      }, 100);
    }

    // --- Filtering ---
    function applyFilter() {
      let filtered = [...allCoins];
      const q = document.getElementById("searchCoin").value.trim().toLowerCase();
      if (q) {
        filtered = filtered.filter(c =>
          c.name.toLowerCase().includes(q) ||
          c.symbol.toLowerCase().includes(q)
        );
      }
      if (currentFilter === "up") {
        filtered = filtered.slice().sort((a, b) => b.price_change_percentage_24h - a.price_change_percentage_24h).slice(0, 20);
      } else if (currentFilter === "down") {
        filtered = filtered.slice().sort((a, b) => a.price_change_percentage_24h - b.price_change_percentage_24h).slice(0, 20);
      } else if (currentFilter === "favs") {
        const favs = getFavorites();
        filtered = filtered.filter(c => favs.includes(c.id));
      }
      coinsShown = filtered;
      renderMarket(filtered);
    }

    document.getElementById("searchCoin").oninput = applyFilter;
    document.getElementById("filterAll").onclick = () => { currentFilter = "all"; applyFilter(); };
    document.getElementById("filterUp").onclick = () => { currentFilter = "up"; applyFilter(); };
    document.getElementById("filterDown").onclick = () => { currentFilter = "down"; applyFilter(); };
    document.getElementById("filterFavs").onclick = () => { currentFilter = "favs"; applyFilter(); };

    // --- Modal for Coin Chart ---
    window.showCoinModal = async (id, name, symbol) => {
      document.getElementById("modal").classList.remove("hidden");
      document.getElementById("modalTitle").textContent = `${name} (${symbol.toUpperCase()})`;
      const chartContainer = document.getElementById("modalChartContainer");
      const chartLoading = document.getElementById("modalChartLoading");
      const chartEl = document.getElementById("modalChart");
      chartLoading.style.display = "";
      chartEl.style.display = "none";
      chartContainer.classList.add("fade-in");
      let chartInstance = null;
      try {
        const url = `https://api.coingecko.com/api/v3/coins/${id}/market_chart?vs_currency=usd&days=30`;
        const res = await fetch(url);
        const data = await res.json();
        const prices = data.prices || [];
        if (!prices.length) throw new Error("No chart data");
        const labels = prices.map(p => {
          const d = new Date(p[0]);
          return `${d.getMonth()+1}/${d.getDate()}`;
        });
        const values = prices.map(p => p[1]);
        chartLoading.style.display = "none";
        chartEl.style.display = "";
        chartInstance = new Chart(chartEl, {
          type: "line",
          data: {
            labels,
            datasets: [{
              label: "Price (USD)",
              data: values,
              borderColor: "#22c55e",
              backgroundColor: "rgba(34,197,94,0.1)",
              tension: 0.2
            }]
          },
          options: {
            plugins: { legend: { display: false } },
            scales: {
              x: { ticks: { color: "#d1d5db" }, grid: { color: "#222" } },
              y: { ticks: { color: "#d1d5db" }, grid: { color: "#222" } }
            }
          }
        });
      } catch {
        chartLoading.textContent = "Failed to load chart.";
        chartLoading.style.display = "";
        chartEl.style.display = "none";
      }
    };

    
    document.getElementById("closeModal").onclick = (e) => {
      e.stopPropagation();
      document.getElementById("modal").classList.add("hidden");
      document.getElementById("modalChartContainer").classList.remove("fade-in");
      document.getElementById("modalChart").style.display = "none";
      document.getElementById("modalChartLoading").textContent = "Loading...";
      document.getElementById("modalChartLoading").style.display = "";
    };
    document.getElementById("modal").onclick = e => {
      if (e.target === document.getElementById("modal")) {
        document.getElementById("modal").classList.add("hidden");
        document.getElementById("modalChartContainer").classList.remove("fade-in");
        document.getElementById("modalChart").style.display = "none";
        document.getElementById("modalChartLoading").textContent = "Loading...";
        document.getElementById("modalChartLoading").style.display = "";
      }
    };

    // --- Init ---
    loadMarket();
  </script>
</body>
</html>
